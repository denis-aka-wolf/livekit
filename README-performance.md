# Руководство по оптимизации производительности LiveKit агента

## Проблемы и решения

### 1. Ошибка "inference is slower than realtime" для Silero VAD

**Проблема**: Система предупреждает, что обработка аудио работает медленнее, чем в реальном времени.

**Решение**: 
- Увеличены параметры `min_speech_duration` с 0.05 до 0.1 секунды
- Увеличены параметры `min_silence_duration` с 0.05 до 0.5 секунды  
- Увеличены параметры `prefix_padding_duration` с 0.1 до 0.2 секунды
- Увеличено значение `min_endpointing_delay` с 0.1 до 0.3 секунды

Эти изменения снижают частоту срабатываний VAD и уменьшают нагрузку на систему, обеспечивая более стабильную работу.

### 2. Ошибка "APITimeoutError: Request timed out" для LLM

**Проблема**: Запрос к языковой модели превышает установленный таймаут.

**Решение**:
- Увеличен таймаут LLM с 60.0 до 120.0 секунд
- Увеличено количество повторных попыток с 2 до 3
- Добавлены оптимизации в конфигурацию Docker Compose для llama.cpp сервера

### 3. Оптимизация конфигурации Docker

**Добавлены параметры**:
- `--n-gpu-layers 0`: Отключение GPU для стабильности CPU-обработки
- `--parallel 4`: Поддержка параллельных запросов
- `--log-disable`: Отключение логирования для улучшения производительности

## Рекомендации по дальнейшей оптимизации

1. **Мониторинг производительности**: Регулярно проверяйте загрузку CPU и памяти во время работы агента
2. **Настройка под конкретное оборудование**: Подбирайте параметры под характеристики вашего сервера
3. **Оптимизация моделей**: Используйте квантованные версии моделей для ускорения инференса
4. **Баланс между качеством и скоростью**: Настраивайте параметры VAD под требования конкретного сценария использования

## Параметры, которые можно регулировать

- `min_speech_duration`: Минимальная длительность речи для детекции (увеличьте для снижения нагрузки)
- `min_silence_duration`: Минимальная тишина перед завершением речи (увеличьте для стабильности)
- `timeout`: Таймаут для LLM запросов (увеличьте при медленных ответах)
- `max_retries`: Количество повторных попыток при ошибках
- `--threads`: Количество потоков для обработки (настраивается под количество ядер CPU)

## Перезапуск сервисов

После внесения изменений выполните перезапуск сервисов:

```bash
docker compose down
docker compose up -d
```

Для проверки состояния сервисов используйте:

```bash
docker compose ps
docker logs llama_cpp