version: '3.8'


services:
  my-agent:
    image: python:3.12-slim
    volumes:
      - .:/app
    working_dir: /app
    # network_mode: host → заменяем на явное указание портов
    ports:
      - "8080:8080"  # Если агент будет слушать HTTP (опционально)
    restart: always
    environment:
      LIVEKIT_URL: "ws://158.160.2.82:7880"  # Важно: ws://, а не http://
      LIVEKIT_API_KEY: "APImmvWFZNCYdk6"
      LIVEKIT_API_SECRET: "uHPsJbenS3sLS4X8rZHqph61bT5QlTWnHnTNsR2r92a"
      SIP_OUTBOUND_TRUNK_TEST_ID: "ST_97rCMAowq5jp"
    command: >
      sh -c "
        python -m venv /opt/venv && \
        /opt/venv/bin/pip install --upgrade pip && \
        /opt/venv/bin/pip install livekit-agents livekit-api python-dotenv && \
        /opt/venv/bin/python -u agent.py dev
      "
